#!/bin/bash

# dependencies /////////////////////////////////////////////////////////////////

if [[ -z $(command -v frobulator) ]]
then
	if [[ $(id -u -n) = "root" ]]
	then
		SUDO_HOME=/root

		USER="${SUDO_USER}"

		HOME=/home/"${USER}"
	fi

	if [[ -z $(command -v curl) ]]
	then
		yes | apt-get install curl
	fi

	if [ ! -d "${HOME}"/.local/bin ]
	then
		mkdir -p "${HOME}"/.local/bin
	fi

	curl -s -L get.frbltr.app > "${HOME}"/.local/bin/frobulator

	chmod +x "${HOME}"/.local/bin/frobulator
fi

. "${HOME}"/.local/bin/frobulator

# script ///////////////////////////////////////////////////////////////////////

script=$(basename -- "${BASH_SOURCE[0]}")

# version //////////////////////////////////////////////////////////////////////

version="08-08-2023"

# usage ////////////////////////////////////////////////////////////////////////

# prompt ///////////////////////////////////////////////////////////////////////

frobulator.script "Setting up ${script#*-}"
echo

# variables ////////////////////////////////////////////////////////////////////

frobulator.progress () {
	# catch PID of last command

	PID=$!

	spinner="⎺⎻⎼⎽⎼⎻"

	before="[ "
	after=" ]"

	notification="${@}"

	if [ $# -eq 1 ]
	then
		type="${1}"


if [[ "${type}" = [aA-zZ] ]]
then
			if [[ "${type}" = "download" ]]
			then
				color="${magenta}"

			elif [[ "${type}" = "upload" ]]
			then
				color="${purple}"

			elif [[ "${type}" = "generate" ]]
			then
				color="${lime}"

			elif [[ "${type}" = "parse" ]]
			then
				color="${grey}"

			elif [[ "${type}" = "install" ]]
			then
				color="${silver}"

			elif [[ "${type}" = "reinstall" ]]
			then
				color="${silver}"

			elif [[ "${type}" = "remove" ]]
			then
				color="${silver}"

			elif [[ "${type}" = "purge" ]]
			then
				color="${silver}"

			elif [[ "${type}" = "update" ]]
			then
				color="${yellow}"

			elif [[ "${type}" = "upgrade" ]]
			then
				color="${yellow}"

			elif [[ "${type}" = "hold" ]]
			then
				color="${yellow}"

			elif [[ "${type}" = "release" ]]
			then
				color="${yellow}"

			elif [[ "${type}" = "clean" ]]
			then
				color="${blue}"

			elif [[ "${type}" = "evaluate" ]]
			then
				color="${blue}"
			fi

		else
			type="process"
		fi

		notification="${type}"

	else
		color="${white}"
	fi

	notification="${notification^}"

	if [ "${notification: -1}" = "e" ]
	then
		notification=${notification/%e/ing...}
	else
		notification=${notification/%/ing...}
	fi

	frobulator.prompt "${notification}"

	value="${frobulator_string[@]}"

	i=1

	while [ -d /proc/"${PID}" ]
	do
		if [ ! -d /proc/"${PID}" ]
        then
			break
        fi

		echo -n -e "\r${before}${color} \b${spinner:i++%${#spinner}:1}${reset}${after} ${value}\c "

		sleep 0.25
	done

	unset color

	echo

	# normalize line spacing:
	# additional 'echo' required due to carriage return

	echo
}


frobulator.inf "Test line 1 - information"
frobulator.nul "Test line 2"
echo

frobulator.msg "Test line 1 - message"
frobulator.nul "Test line 2"
echo

frobulator.add "Test line 1 - add"
frobulator.nul "Test line 2"
echo

frobulator.rem "Test line 1 - remove"
frobulator.nul "Test line 2"
echo

frobulator.ret "Test line 1 - retain"
frobulator.nul "Test line 2"
echo

frobulator.rel "Test line 1 - release"
frobulator.nul "Test line 2"
echo

frobulator.fwd "Test line 1 - forward"
frobulator.nul "Test line 2"
echo

frobulator.rev "Test line 1 - reverse"
frobulator.nul "Test line 2"
echo

frobulator.stp "Test line 1 - stop"
frobulator.nul "Test line 2"
echo

frobulator.dwl "Test line 1 - download"
frobulator.nul "Test line 2"
echo

frobulator.upl "Test line 1 - upload"
frobulator.nul "Test line 2"
echo

frobulator.lnk "Test line 1 - link"
frobulator.nul "Test line 2"
echo

frobulator.scs "Test line 1 - success"
frobulator.nul "Test line 2"
echo

frobulator.wrn "Test line 1 - warning"
frobulator.nul "Test line 2"
echo

frobulator.err "Test line 1 - error"
frobulator.nul "Test line 2"
echo

frobulator.ins "Test line 1 - insert"
frobulator.nul "Test line 2"
echo

frobulator.ask "Test line 1 - question"
frobulator.nul "Test line 2"
echo

frobulator.ipt "Test line 1 - input"
frobulator.nul "Test line 2"
echo

frobulator.usr "Test line 1 - user"
frobulator.nul "Test line 2"
echo

frobulator.separate

frobulator.white "white"
frobulator.silver "silver"
frobulator.grey "grey"
frobulator.black "black"
echo

frobulator.red "red"
frobulator.crimson "crimson"
echo

frobulator.green "green"
frobulator.lime "lime"
echo

frobulator.yellow "yellow"
frobulator.orange "orange"
echo

frobulator.blue "blue"
frobulator.navy "navy"
echo

frobulator.magenta "magenta"
frobulator.purple "purple"
echo

frobulator.fuschia "fuschia"
frobulator.pink "pink"
echo

frobulator.aqua "aqua"
frobulator.teal "teal"
echo

frobulator.separate

curl -s -L https://cdimage.ubuntu.com/ubuntu-base/releases/22.04/release/ubuntu-base-22.04-base-arm64.tar.gz > /dev/null &

frobulator.progress 0xxx00
