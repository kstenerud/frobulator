#!/bin/bash

# dependencies /////////////////////////////////////////////////////////////////

if [[ -z $(command -v frobulator) ]]
then
	if [[ $(id -u -n) = "root" ]]
	then
		SUDO_HOME=/root

		USER="${SUDO_USER}"

		HOME=/home/"${USER}"
	fi

	if [[ -z $(command -v curl) ]]
	then
		yes | apt-get install curl
	fi

	if [ ! -d "${HOME}"/.local/bin ]
	then
		mkdir -p "${HOME}"/.local/bin
	fi

	curl -s -L get.frbltr.app > "${HOME}"/.local/bin/frobulator

	chmod +x "${HOME}"/.local/bin/frobulator
fi

. "${HOME}"/.local/bin/frobulator

# script ///////////////////////////////////////////////////////////////////////

script=$(basename -- "${BASH_SOURCE[0]}")

# version //////////////////////////////////////////////////////////////////////

version="08-13-2023"

# usage ////////////////////////////////////////////////////////////////////////

# process //////////////////////////////////////////////////////////////////////

# process //////////////////////////////////////////////////////////////////////

# progress /////////////////////////////////////////////////////////////////////
marker_elp='...'
marker_prc='%'
marker_spc=' '

frobulator.progress () {

	# catch PID of last command

	PID=${PID}

	ticker='⎺⎻⎼⎽⎼⎻'

	before="[${marker_spc}"
	after="${marker_spc}]"

	notification=("${@}")

	# process alphabetical arguments only

	if [[ "${notification}" =~ [a-zA-Z] ]]
	then
		if [[ "${notification}" = "download" ]]
		then
			color="${magenta}"

		elif [[ "${notification}" = "upload" ]]
		then
			color="${purple}"

		elif [[ "${notification}" = "install" ]]
		then
			color="${blue}"

		elif [[ "${notification}" = "reinstall" ]]
		then
			color="${navy}"

		elif [[ "${notification}" = "remove" ]]
		then
			color="${red}"

		elif [[ "${notification}" = "purge" ]]
		then
			color="${crimson}"

		elif [[ "${notification}" = "update" ]] || \
		     [[ "${notification}" = "clone"  ]]
		then
			color="${yellow}"

		elif [[ "${notification}" = "upgrade" ]]
		then
			color="${orange}"

		elif [[ "${notification}" = "hold" ]]
		then
			color="${aqua}"

		elif [[ "${notification}" = "release" ]] || \
		     [[ "${notification}" = "build"   ]]
		then
			color="${teal}"

		elif [[ "${notification}" = "clean" ]]
		then
			color="${black}"

		elif [[ "${notification}" = "parse" ]]
		then
			color="${green}"

		elif [[ "${notification}" = "generate" ]]
		then
			color="${lime}"

		elif [[ "${notification}" = "evaluate" ]] || \
		     [[ "${notification}" = "probe"    ]]
		then
			color="${silver}"

		elif [[ "${notification}" = "process" ]]
		then
			color="${grey}"

		else
			# set fallback for unwanted input notification

			notification="process"

			color="${grey}"
		fi
	fi

	if [ -z "${notification}" ]
	then
		# set fallback for empty input notification

		notification="frobulate"

		color="${white}"
	fi

	# select notification index for transformation

	notification=${notification[0]}

	# set notification to first letter uppercase

	notification="${notification^}"

	if [ $# -le 1 ]
	then
		if [ "${notification: -1}" = "e" ]
		then
			notification="${notification/%e/ing$marker_elp}"
		else
			notification="${notification/%/ing$marker_elp}"
		fi
	fi

	if [ $# -ge 2 ]
	then
		if [ "${notification: -1}" = "e" ]
		then
			notification="${notification/%e/ing}"
		else
			notification="${notification/%/ing}"

		fi
	fi

	notification[0]="${notification}"

	frobulator.pmt ${notification[@]}

	prompt="${prompt_string[@]}"

	i=1

	while [ -d /proc/"${PID}" ]
	do
		if [ ! -d /proc/"${PID}" ]
        then
			break
        fi

		echo -n -e "\r${before}${color} \b${ticker:i++%${#ticker}:1}${reset}${after}${marker_spc}${prompt}\c"

		sleep 0.25
	done

	unset color

	echo

	# normalize line spacing:
	# additional 'echo' required due to carriage return

	echo
}

# variables ////////////////////////////////////////////////////////////////////

frobulator.inf "Test line 1 - information"
frobulator.nul "Test line 2"
echo

frobulator.msg "Test line 1 - message"
frobulator.nul "Test line 2"
echo

frobulator.add "Test line 1 - add"
frobulator.nul "Test line 2"
echo

frobulator.rem "Test line 1 - remove"
frobulator.nul "Test line 2"
echo

frobulator.ret "Test line 1 - retain"
frobulator.nul "Test line 2"
echo

frobulator.rel "Test line 1 - release"
frobulator.nul "Test line 2"
echo

frobulator.fwd "Test line 1 - forward"
frobulator.nul "Test line 2"
echo

frobulator.rev "Test line 1 - reverse"
frobulator.nul "Test line 2"
echo

frobulator.stp "Test line 1 - stop"
frobulator.nul "Test line 2"
echo

frobulator.dwl "Test line 1 - download"
frobulator.nul "Test line 2"
echo

frobulator.upl "Test line 1 - upload"
frobulator.nul "Test line 2"
echo

frobulator.lnk "Test line 1 - link"
frobulator.nul "Test line 2"
echo

frobulator.scs "Test line 1 - success"
frobulator.nul "Test line 2"
echo

frobulator.wrn "Test line 1 - warning"
frobulator.nul "Test line 2"
echo

frobulator.err "Test line 1 - error"
frobulator.nul "Test line 2"
echo

frobulator.ins "Test line 1 - insert"
frobulator.nul "Test line 2"
echo

frobulator.ask "Test line 1 - question"
frobulator.nul "Test line 2"
echo

frobulator.ipt "Test line 1 - input"
frobulator.nul "Test line 2"
echo

frobulator.usr "Test line 1 - user"
frobulator.nul "Test line 2"
echo

frobulator.separate

frobulator.white "white"
frobulator.silver "silver"
frobulator.grey "grey"
frobulator.black "black"
echo

frobulator.red "red"
frobulator.crimson "crimson"
echo

frobulator.green "green"
frobulator.lime "lime"
echo

frobulator.yellow "yellow"
frobulator.orange "orange"
echo

frobulator.blue "blue"
frobulator.navy "navy"
echo

frobulator.magenta "magenta"
frobulator.purple "purple"
echo

frobulator.fuschia "fuschia"
frobulator.pink "pink"
echo

frobulator.aqua "aqua"
frobulator.teal "teal"
echo

curl -s -L https://cdimage.ubuntu.com/ubuntu/releases/22.04/release/ubuntu-22.04.3-preinstalled-desktop-arm64+raspi.img.xz > /home/nathanel/image.img.xz &

frobulator.progress
